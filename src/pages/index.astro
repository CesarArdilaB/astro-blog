---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import PostCard from '../components/PostCard.astro';
import Footer from '../components/Footer.astro';

const posts = await getCollection('post');
const _sortedPosts = posts.sort((a, b) => {
	// Handle cases where publishDate might be undefined, though schema says optional, let's be safe
	const dateA = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
	const dateB = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
	return dateB - dateA;
});
---

<Layout>
	<main class="min-h-screen grid grid-cols-1 md:grid-cols-12 gap-px bg-brand-border border border-brand-border">
		
		<!-- Section 1: Header / Hero -->
		<!-- Logo -->
		<div class="col-span-1 md:col-span-3 bg-brand-dark text-brand-light p-6 flex items-center justify-between group border-b md:border-b-0 border-brand-border">
			<img src="/logo_barras.png" alt="Caesar Codes Logo" class="h-12 w-auto" />
			<span class="font-mono text-xl tracking-tighter font-bold bg-brand-accent text-brand-dark px-1">caesar.codes</span>
		</div>

		<!-- Marquee -->
		<div class="col-span-1 md:col-span-9 bg-brand-dark flex items-center overflow-hidden relative border-l-0 md:border-l border-brand-border">
			<div class="animate-marquee whitespace-nowrap font-mono text-xs md:text-sm tracking-widest text-brand-light/80 py-6">
				FORM FOLLOWS FUNCTION /// SHIPPING VALUE /// NO BLOAT /// FORM FOLLOWS FUNCTION /// SHIPPING VALUE /// NO BLOAT /// FORM FOLLOWS FUNCTION /// SHIPPING VALUE /// NO BLOAT ///
			</div>
			<div class="absolute top-0 right-0 h-full w-24 bg-linear-to-l from-brand-dark to-transparent z-10"></div>
			<div class="absolute top-0 left-0 h-full w-24 bg-linear-to-r from-brand-dark to-transparent z-10"></div>
		</div>

		<!-- Hero Headline -->
		<div class="col-span-1 md:col-span-12 bg-brand-dark text-brand-light p-12 md:p-24 flex flex-col justify-center border-t border-brand-border relative overflow-hidden">
			<h1 class="font-mono text-5xl md:text-8xl font-bold tracking-tighter leading-none glitch-text mb-4" data-text="PRODUCT BUILDER.">
				PRODUCT ENGINEER.
			</h1>
			<p class="font-sans text-xl md:text-2xl text-gray-400 max-w-2xl">
				Digital Artisan & Strategist. <span class="text-brand-accent">25 Years of Shipping.</span>
			</p>
			
			<!-- Decorative grid background element -->
			<div class="absolute top-0 right-0 w-1/3 h-full opacity-10 pointer-events-none" 
				style="background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px;">
			</div>
		</div>

		<!-- Section 2: The Manifesto -->
		<div class="col-span-1 md:col-span-12 bg-brand-dark p-12 md:p-32 border-t border-brand-border flex items-center justify-center text-center">
			<h2 class="font-sans font-bold text-4xl md:text-7xl uppercase tracking-tight leading-tight max-w-5xl">
				Code is a <span class="text-gray-500 line-through decoration-brand-accent decoration-4">cost</span>. <br/>
				Value is the <span class="text-brand-light border-b-4 border-brand-accent">product</span>.
			</h2>
		</div>

		<!-- Section 3: Output / Logs -->
		<div class="col-span-1 md:col-span-12 bg-brand-dark border-t border-brand-border grid grid-cols-1 md:grid-cols-3 gap-px">
			<div class="col-span-1 md:col-span-3 bg-brand-dark p-6 border-b border-brand-border flex items-center gap-4">
				<div class="w-3 h-3 bg-brand-accent"></div>
				<h3 class="font-mono text-lg tracking-widest">TRANSMISSIONS_LOG</h3>
			</div>

			{_sortedPosts.map((post) => (
				<PostCard post={post} />
			))}
			
			<!-- Fillers to maintain grid if needed, or leave empty space. For now, just rendering posts. -->
		</div>

		<!-- Section 4: Footer -->
		<Footer />

	</main>
</Layout>

<style>
	/* Marquee Animation */
	@keyframes marquee {
		0% { transform: translateX(0); }
		100% { transform: translateX(-50%); }
	}
	.animate-marquee {
		display: inline-block;
		animation: marquee 20s linear infinite;
	}

	/* Glitch Effect */
	.glitch-text {
		position: relative;
	}
	
	.glitch-text::before,
	.glitch-text::after {
		content: attr(data-text);
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: #050505;
	}

	.glitch-text::before {
		left: 2px;
		text-shadow: -1px 0 #ff00c1;
		clip: rect(44px, 450px, 56px, 0);
		animation: glitch-anim 5s infinite linear alternate-reverse;
	}

	.glitch-text::after {
		left: -2px;
		text-shadow: -1px 0 #00fff9;
		clip: rect(44px, 450px, 56px, 0);
		animation: glitch-anim2 5s infinite linear alternate-reverse;
	}

	@keyframes glitch-anim {
		0% { clip: rect(38px, 9999px, 83px, 0); }
		20% { clip: rect(7px, 9999px, 86px, 0); }
		40% { clip: rect(54px, 9999px, 14px, 0); }
		60% { clip: rect(2px, 9999px, 3px, 0); }
		80% { clip: rect(28px, 9999px, 96px, 0); }
		100% { clip: rect(81px, 9999px, 4px, 0); }
	}

	@keyframes glitch-anim2 {
		0% { clip: rect(52px, 9999px, 20px, 0); }
		20% { clip: rect(98px, 9999px, 6px, 0); }
		40% { clip: rect(13px, 9999px, 89px, 0); }
		60% { clip: rect(79px, 9999px, 26px, 0); }
		80% { clip: rect(41px, 9999px, 1px, 0); }
		100% { clip: rect(4px, 9999px, 78px, 0); }
	}
</style>
